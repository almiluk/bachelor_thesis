\chapter{Онтологически управляемые периферийные вычисления. Конкретизация задач}

Онтологически управляемые периферийные вычисления (англ. Ontology-Driven Edge Computing)~--- подход, основанный на внедрении интеллектуальности в периферийные устройства в рамках экосистемы Интернета вещей \cite{incollection:onto-reasoning-on-mcu}.
Использование онтологий позволяет описывать и управлять функциональностью и поведением периферийных устройств на основе знаний и семантических моделей.

В рамках такого подхода традиционная прошивка (встраиваемая программа) для устройств заменяется на комбинацию трёх компонентов:
\begin{enumerate}
	\item Прикладной онтологии, описывающей доступные для выполнения на устройстве действия, средства коммуникации устройства, его состав и другие знания, жёстко привязанные к устройству.
	\item Онтологии задачи, описывающая действия, необходимые для решения конкретной задачи.
	\item Механизма логического вывода, выполняющий вычисления, описываемые онтологией задачи.
	Это своего рода интерпретатор алгоритмов, записанных в онтологическом виде.
\end{enumerate}

Механизм логического вывода является специальной встраиваемой программой для периферийных устройств и выполняется непосредственно на них.
Прикладная онтология используется для составления онтологий задач, а также их сжатия и разжатия с использованием формата EON, описание которого приводится ниже.
За счёт этого, отсутствует необходимость хранить такую онтологию на конечном устройстве, так как она не используется непосредственно в момент вычислений, в отличие от онтологии задачи.
Прикладная онтология может храниться на отдельном внешнем устройстве, к которому у устройства, производящего вычисления, есть сетевой доступ.

\section{Онтологически управляемые периферийные вычисления в системе SciVi}

На основе прикладной онтологии средства SciVi генерируют инструменты для получения, обработки и визуализации различных данных.
Для использования этих инструментов SciVi предоставляет высокоуровневый графический интерфейс, также генерируемый на основе прикладной онтологии.
Данный интерфейс позволяет создавать диаграммы потоков данных (англ. Data Flow Diagrams, DFD), описывая узлы обработки данных и то, как данные должны передаваться между ними.
В рамках SciVi такие узлы именуются операторами.
Операторы описывают различные действия с данными, которые могут быть выполнены на клиентской или серверной частях платформы, а также на внешних устройствах.
Для реализации последнего варианта и применяется подход онтологически управляемых периферийных вычислений.

Пример диаграммы потоков данных приведён на рисунке \ref{dig:scivi-dfd}.
На нём скруглённые прямоугольники~--- операторы SciVi, а линии показывают направления передачи данных (в левой части оператора его входные данные, в правой~--- выходные).
В приведённом примере оператор ADC (англ. Analog-to-digital converter, Аналогово-цифровой преобразователь) выполняется на периферийном устройстве и передаёт результат его выполнения на клиентскую часть приложения по протоколу WebSocket.
Остальные операторы исполняются в самой клиентской части.

\myfigure[width=\textwidth]{scivi-dfd}{Пример диаграммы потоков данных в платформе SciVi}{dig:scivi-dfd}

На основе DFD, созданной пользователем, SciVi генерирует онтологию задачи, соответствующую операциям с данными для выполнения на периферийном устройстве.
Затем эта онтология сжимается и передаётся на конечное устройство, где она исполняется с помощью механизма логического вывода, после чего результаты её выполнения могут быть переданы другим устройствам в соответствии с составленной DFD.

В качестве периферийных устройств SciVi, в основном, использует микроконтроллеры ESP8266, которые будут являться целевой платформой для последующих разработок в рамках данной работы.

\section{Когнитивное сжатие онтологий. Формат EON}

Микроконтроллеры обычно обладают небольшим объёмом оперативной памяти, например, у популярного микроконтроллера ATtiny45 её объём составляет всего 256 байт.
Вследствие этого хранить на устройстве онтологии задач в стандартных форматах, таких как OWL и RFD, не представляется возможным.
Для сжатия онтологий в процессе работы над платформой SciVi был разработан специальный формат~--- EON (англ. Embedded or Edge ONtology).

Перевод онтологии в формат EON включается в себя два основных этапа:
\begin{enumerate}
	\item Когнитивное сжатие.
	На данном этапе из онтологии удаляются избыточные знания, которые в будущем могут быть восстановлены с помощью прикладной онтологии.
	Затем из онтологии удаляются все связи, кроме instance{\_}of (с их помощью онтология задачи связывается с прикладной онтологией, поэтому они необходимы для разжатия) и use{\_}for (эта связь используется для описания направления передачи данных на основе DFD).
	Важно отметить, что набор сохраняемых связей не является фиксированным и может быть изменён (в том числе расширен) при необходимости.
	Кроме того, все имена узлов и связей заменяются на численные идентификаторы.
	Для связей и узлов прикладной онтологии идентификаторы берутся из неё самой, а для узлов онтологии задач генерируются автоматически и сохраняются во время всего процесса обработки онтологии.
	\item Затем полученная онтология сериализуется в особый бинарный формат EON, в котором в дальнейшем передаётся и обрабатывается.
\end{enumerate}

При необходимости всегда может быть проведён обратный процесс разжатия, требующий только прикладную онтологию, эквивалентную той, что использовалась при сжатии.

Приведённый алгоритм позволяет сжимать онтологии даже в сотни раз по сравнению с используемыми обычно форматами.

\section{Встраиваемый механизм логического вывода}

Механизм логического вывода работает на самих периферийных устройствах и по своей сути является их прошивкой.
Архитектура такого механизма представлена на рисунке \ref{fig:reasoner} \cite{incollection:onto-reasoning-on-mcu}.

\myfigure[width=\columnwidth]{reasoner}{Архитектура встраиваемого механизма логического вывода}{fig:reasoner}

Рассматриваемый механизм логически разделён на несколько сообщающихся элементов:
\begin{itemize}
	\item Модуль функций (Functions Module на рисунке). Модуль управляет аппаратными ресурсами устройства и определяет доступные для использования операторы SciVi.
	\item Модуль коммуникации (Communication Module). Модуль обеспечивает передачу данных и команд между этим и другими устройствами системы SciVi.
	      В зависимости от устройства, модуль может включать средства для сетевой связи по протоколу WebSocket, через интерфейс UART и различными иными способами.
	\item Модуль выполнения (Evaluation Core). Элемент обходит онтологию задачи в формате EON и вызывает операторы.
	\item Модуль чтения/записи (EON Reader/Writer). Элемент осуществляет чтение и запись онтологии в память устройства.
	\item Буфер результатов (Evaluation Buffer). Буфер для хранения результатов выполнения операторов.
	\item Буфер замещения (Substitution Buffer). Буфер для перезаписи результатов выполнения операторов и управления устройством извне через модуль коммуникации.
\end{itemize}

Данный механизм реализован в рамках платформы SciVi на языке программирования \CPP~и может исполняться на различных устройствах (протестирован на ESP8266, ATmega328 и ATtiny45).
Эта реализация может быль перенесена и на множество других устройств, за счёт использования универсальных инструментов среды разработки Arduino IDE и различных дополнений к ней.

Важно отметить, что различные устройства могут отличаться набором доступных операций и средств связи, поэтому итоговые прошивки, использующие описанный механизм, для разных устройств должны отличаться.
Для решения этой проблемы SciVi имеет специальное средство, генерирующие конкретные прошивки, содержащие встраиваемый механизм логического вывода, автоматизированно на основе онтологического описания целевого устройства, создаваемого пользователем.

\section{Существующие проблемы коммуникации механизма логического вывода}

На момент начала выполнения данной работы описанный механизм имел две значительные проблемы, связанные с коммуникацией с его окружением.

\subsection{Использование энергонезависимой памяти}

Энергонезависимая память~--- особый вид запоминающих устройств, способный хранить данные при отсутствии электропитания.
Такая память используется в составе вычислительных устройств, в том числе для сохранения между их запусками данных, необходимых для инициализации, и конфигурационных данных.
В микроконтроллерах для решения этой задачи обычно используются электрически стираемые перепрограммируемые постоянные запоминающие устройства (ЭСППЗУ, англ. Electrically Erasable Programmable Read-Only Memory, EEPROM)~--- вид устройств энергонезависимой памяти, позволяющих электрическим импульсом стереть сохранённые данные, а затем, при необходимости, записать новые \cite{incollection:eeprom-proposal, article:eeprom}.

Механизм логического вывода SciVi использует EEPROM для хранения онтологий задач.
Это необходимо для того, чтобы устройство могло автоматически возобновить исполнение полученного им ранее алгоритма после временного отсутствия электропитания.
Такое хранение уже было реализовано в SciVi, однако для работы с EEPROM использовались несовершенные и низкоуровневые средства, которые не позволяют удобно использовать EEPROM из независимых программных модулей.
Это вызвано необходимостью ручных манипуляций с адресами памяти при каждом обращении к ней.
В конечном счёте, использование энергонезависимой памяти микроконтроллера механизмом логического вывода делало невозможным её удобное (а для множества случаев~--- любое) использование для других целей,
несмотря на возможно достаточный объём памяти.

Описанная особенность использования EEPROM значительно ограничивает возможности автоматической генерации программ для периферийных устройств платформой SciVi.
Таким образом платформе было необходимо новое, более высокоуровневое, средство для управления EEPROM, которое бы могло автоматизировать использование адресов памяти.

\subsection{Поиск в сети устройств для периферийных вычислений}

Другая проблема связана с сетевой коммуникацией устройств, а именно~--- с их поиском.
Клиентская часть SciVi могла подключаться только к одному периферийному устройству, причём по строго фиксированному IP-адресу.
Этот факт сильно ограничивал возможности использования платформы, требуя поиска устройств и подключения к ним от конечного пользователя.
В связи с этим, платформе потребовался механизм, позволяющий автоматически в любой сети легко находить устройства для выполнения на них онтологически управляемых периферийных вычислений.
После нахождения всех подходящих устройств, пользователь смог бы выбирать, на каком из них выполнять тот или иной оператор SciVi.

\section{Уточнение поставленных задач}

Обобщив вышесказанное, можно уточнить поставленные в работе задачи.
Необходимо разработать два программных модуля на языке программирования \CPP: для высокоуровневого взаимодействия с энергонезависимой памятью микроконтроллеров и для их обнаружения в локальной сети другими устройствами.

Для каждого из таких модулей необходимо:
\begin{enumerate}
	\item Изучить существующие средства для решения аналогичных задач.
	\item Проанализировать найденные средства с точки зрения их использования в онтологически управляемых периферийных вычислениях.
	\item Спроектировать собственное решение, учитывающее потребности и особенности таких вычислений и платформы SciVi.
	\item Реализовать спроектированный модуль.
	\item Интегрировать разработанный модуль в платформу SciVi и провести его тестирование в условиях онтологически управляемых периферийных вычислений.
\end{enumerate}
